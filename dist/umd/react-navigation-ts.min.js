/** @license react-navigation-ts v1.0.0
 * react-navigation-ts.min.js
 * 
 * Copyright (c) 
 * 
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("react"),require("history"),require("qs"),require("react-router-dom")):"function"==typeof define&&define.amd?define(["react","history","qs","react-router-dom"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["react-navigation-ts"]=e(t.React,t.history,t.qs,t.ReactRouterDOM)}(this,(function(t,e,r,a){"use strict";function o(t){return t&&"object"==typeof t&&"default"in t?t:{"default":t}}var s=o(t),i=o(r);const n="default";return class{routes;options;history=e.createBrowserHistory();array;maps={};pathParamArray=[];isNullOrUndefined(t){return null==t}singleOrArrayToArray(t){return this.isNullOrUndefined(t)?[]:Array.isArray(t)?t:[t]}getSingleOrArrayFirst(t){return Array.isArray(t)?t[0]:t}isPathParamRoute(t){return/\/:/.test(t)}uuid(){return(Math.random().toString(16)+Date.now().toString(16)).replace(/[^a-z0-9]/g,"")}formatUrl(t,e={}){let r=this.getSingleOrArrayFirst(this.routes[t]?.path)??t;const a=this.findCurrentRoute(r);for(const[t,r]of Object.entries(a.queryFormat||{}))if("storage"===r&&!this.isNullOrUndefined(e[t])){const r=this.uuid();sessionStorage.setItem(r,JSON.stringify(e[t])),e[t]=r}return"string"==typeof a?.path&&this.isPathParamRoute(a.path)&&(r=a.path.split("/").map((t=>{if(t.startsWith(":")){const r=t.slice(1);if(!this.isNullOrUndefined(e[r])){const t=e[r];return delete e[r],t}}return t})).join("/")),e&&Object.keys(e).length&&(r+=(r.includes("?")?"&":"?")+i["default"].stringify(e)),r}static generator(t){return{...t,$query:{}}}asyncLoadComponent(e){return r=>{const[a,o]=t.useState(this.options?.asyncLoadingComponent??s["default"].createElement("div",null,"正在加载页面资源"));return t.useEffect((()=>{e().then((e=>o(t.createElement(e["default"],r))))["catch"]((()=>o(this.options?.asyncLoadErrorComponent??s["default"].createElement("div",null,"页面资源加载失败"))))}),[]),a}}constructor(t,e){this.routes=t,this.options=e,this.options=e,this.routes=t,this.array=Object.values(t),this.array.forEach((t=>{t.layout??=this.options?.defaultLayout,!1===t.layout&&delete t.layout,this.singleOrArrayToArray(t.path).forEach((e=>{this.isPathParamRoute(e)?this.pathParamArray.push({...t,path:e}):this.maps[e.toLowerCase()]=t}))}))}findCurrentRoute(t=location.pathname){const e=t?.split("?")[0]||"";return this.maps[e.toLowerCase()]||this.pathParamArray.find((t=>new RegExp(`^${t.path.replace(/\/:[^/]+/g,"/([^/]+)")}$`,"i").test(e)))}getQuery(){const t=i["default"].parse(location.search.replace(/^\?/,"")),e=this.findCurrentRoute();if("string"==typeof e?.path&&this.isPathParamRoute(e.path)){const r=location.pathname.split("/");e.path.split("/").forEach(((e,a)=>e.startsWith(":")&&(t[e.slice(1)]=r[a])))}return Object.entries(e.queryFormat||{}).forEach((([e,r])=>{if("number"===r){const r=Number(t[e]);t[e]=isNaN(r)?void 0:r}else if("boolean"===r)t[e]="true"===t[e];else if("storage"===r)try{t[e]=JSON.parse(sessionStorage.getItem(t[e]))}catch{t[e]=void 0}})),t}push(...[t,e]){const r=this.formatUrl(t,e);this.findCurrentRoute(r)?this.history.push(r):location.href=r}replace(...[t,e]){const r=this.formatUrl(t,e);this.findCurrentRoute(r)?this.history.replace(r):location.href=r}open(...[t,e]){window.open(this.formatUrl(t,e))}link(...[t,e]){location.href=this.formatUrl(t,e)}component(){const e=new Map;return this.array.forEach((t=>{const r=e.get(t.layout||n)||[];r.push(t),e.set(t.layout||n,r)})),s["default"].createElement(a.Router,{history:this.history},s["default"].createElement(a.Switch,null,[...e.keys()].map((r=>{const o=e.get(r)||[],i=o.reduce(((t,e)=>[...t,...this.singleOrArrayToArray(e.path)]),[]),u=o.map((t=>s["default"].createElement(a.Route,{key:`${t.path}`,exact:!0,path:t.path,component:this.asyncLoadComponent(t.component)})));return r===n?u:s["default"].createElement(a.Route,{key:`${i}`,exact:!0,path:i},t.createElement(r,{children:u}))}))))}}}));
